@{
    ViewData["Stylesheet"] = "/css/manager.css";
}

<div class="watermark_concept">
    <p class="concept_text">CONCEPT</p>
</div>
<div class="content_container">
    <aside>
        <partial name="Calendar" model="new CalendarData {
            CurrentMonth = 9,
            CurrentYear = 2022,
            FirstWeekdayOfMonth = 4,
            Today = new DateOnly(2022, 9, 26),
            Selected = new DateOnly(2022, 9, 30),
            MinimumDay = new DateOnly(2022, 9, 27)
        };" />
        <hr />
        <p>Afdeling</p>
        <ul>
            @foreach(var department in ViewBag.Departments)
            {
                var linkClasses = "";
                @if(department.Name == ViewBag.Department.Name)
                {
                    linkClasses = "blue";
                }
                <li class="@linkClasses"><a asp-controller="Manager" asp-action="Scheduling" asp-route-departmentName="@department.Name" asp-route-year="@ViewBag.Date.Year" asp-route-month="@ViewBag.Date.Month" asp-route-day="@ViewBag.Date.Day">@department.Name</a></li>
            }
        </ul>
    </aside>
    <div>
        <header>
            <h1 class="align_center">
                <button class="nav_button" asp-controller="Manager" asp-action="Scheduling">&#x2039;</button>
                <button class="nav_button" asp-controller="Manager" asp-action="Scheduling">&#x203A;</button>
                Inroostering: @ViewBag.DutchDate
            </h1>
        </header>
        <table>
            <tr>
                <td class="align_center"></td>
                <td class="align_center"></td>
                <td class="align_center"></td>
                @for(int hour = ViewBag.StartHour; hour <= ViewBag.EndHour; hour++)
                {
                    <td class="align_center">@hour:00</td>
                }
            </tr>
            <tr class="seperator"></tr>
            <tr>
                <td class="align_right" colspan="3">Prognose</td>
                @for(int hour = ViewBag.StartHour; hour <= ViewBag.EndHour; hour++)
                {
                    <td class="align_center prognosis_mismatch" id="text_hour_@hour">0/@ViewBag.EmployeePrognosis[hour]</td>
                }
            </tr>
            <tr class="seperator"></tr>
            @foreach(var employee in ViewBag.Employees)
            {
                <tr>
                    <td class="align_right" colspan="3">@employee.Name</td>
                    @for(int hour = ViewBag.StartHour; hour <= ViewBag.EndHour; hour++)
                    {
                        <td class="align_center"><input type="checkbox" class="checkbox_hour_@hour" onclick="update_text(@hour);" /></td>
                    }
                </tr>
            }
        </table>
        <div class="space_around">
            <button>Opslaan</button>
        </div>
    </div>
</div>
<script>
    function update_text(id) {
        var max = $("#text_hour_" + id).text().split("/")[1];
        var current = 0;

        $(".checkbox_hour_" + id).each(function() {
            if($(this).prop("checked")) current++;
        })

        $("#text_hour_" + id).text(current + "/" + max);

        if(max == current) $("#text_hour_" + id).removeClass("prognosis_mismatch");
        else if(!$("#text_hour_" + id).hasClass("prognosis_mismatch")) $("#text_hour_" + id).addClass("prognosis_mismatch");
    }
</script>